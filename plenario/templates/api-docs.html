{% extends 'base.html' %}
{% block title %}API Documentation - Plenar.io{% endblock %}
{% block content %}
<div class='col-md-10 col-md-offset-1'>
    <br/>
    <div class="col-md-8 col-md-offset-2">
      <div class="panel panel-default">
        <div class="panel-heading">
          <h1 class="panel-title">Note</h1>
        </div>
        <div class="panel-body">
          <p class="lead">The easiest way to access Plenar.io&rsquo;s data and to build your own queries is via the <a href="{{ url_for('views.explore_view') }}">Data Explorer</a>.</p>
        </div>
      </div>
    </div>
    <div class="row"></div>
      <hr />
      
      <h2 id="docs">For developers</h2>
      <p><strong></strong> The Plenar.io RESTful API can be used to perform custom geospatial and temporal queries.</p>  

      <p>A few things to know:</p>

      <ul>
        <li>All API calls should be made with <code>HTTP GET</code></li>
        <li>All API responses are in <a href='http://www.json.org/'>JSON format</a> by default. Some responses support <a href='http://en.wikipedia.org/wiki/Comma-separated_values'>CSV format</a>.</li>
        <li>All methods are accessed via: <code>http://plenar.io/v1/api/SOME-ENDPOINT</code></li>
      </ul>

      <h2 id='endpoints'>Endpoints</h2>
      <p>Currently there are six API endpoints:</p>

      <div class="panel-group" id="accordion-api">
        <div class="panel panel-default">
          <div class="panel-heading">
            <a data-toggle="collapse" data-parent="#accordion-api" href="#collapse-api" id="api">
              <strong><code>/v1/api/datasets/</code></strong>
              - list datasets and metadata available
            </a>
          </div>
          <div id="collapse-api" class="panel-collapse collapse">
            <div class="panel-body">
              <p>This is the “data about the data” endpoint. It contains a record for each dataset.</p>

              <p><strong>Query Parameters</strong></p>
              <p>This API endpoint doesn't take in any query parameters.</p>

              <p><strong>Response</strong></p>
              <table class='table table-bordered'>
                <thead>
                  <tr>
                    <th>Parameter</th>
                    <th>Description</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td><strong><code>description</code></strong></td>
                    <td>Verbose, official description of the dataset.</td>
                  </tr>
                  <tr>
                    <td><strong><code>source_url</code></strong></td>
                    <td>If available, the URL where the data was originally sourced.</td>
                  </tr>
                  <tr>
                    <td><strong><code>obs_from</code></strong></td>
                    <td>Oldest date available in the dataset.</td>
                  </tr>
                  <tr>
                    <td><strong><code>obs_to</code></strong></td>
                    <td>Newest date available in the dataset.</td>
                  </tr>
                  <tr>
                    <td><strong><code>human_name</code></strong></td>
                    <td>Human friendly name for the dataset.</td>
                  </tr>
                  <tr>
                    <td><strong><code>dataset_name</code></strong></td>
                    <td>Machine name for the dataset. Values are passed into the queries below as <code>dataset_name</code>.</td>
                  </tr>
                  <tr>
                    <td><strong><code>update_freq</code></strong></td>
                    <td>Update frequency.</td>
                  </tr>
                </tbody>
              </table>

              <div class='well examples'>
                <p><strong>Example</strong></p>
                <p>
                  <a href='/v1/api/'>http://plenar.io/v1/api/</a><br />
                  Returns a list of datasets available in Plenar.io
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="panel-group" id="accordion-api-timeseries">
        <div class="panel panel-default">
          <div class="panel-heading">
            <a data-toggle="collapse" data-parent="#accordion-api-timeseries" href="#collapse-api-timeseries" id="api-timeseries">
              <strong><code>/v1/api/timeseries/</code></strong>
              - query aggregate counts of available data bounded by a time window and geography
            </a>
          </div>
          <div id="collapse-api-timeseries" class="panel-collapse collapse">
            <div class="panel-body">
                    <p>
                        This endpoint contains a record for every row in every dataset with
                        brief temporal and spatial information about the row. This can give a user of the platform a quick overview about what is available within
                        their constraints.
                    </p>
                    
                    <p><strong>Query parameters</strong></p>
                    <p>All query parameters are optional</p>
                    <table class='table table-bordered'>
                      <thead>
                        <tr>
                          <th>Parameter</th>
                          <th>Default value</th>
                          <th>Description</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td><strong><code>agg</code></strong></td>
                          <td>day</td>
                          <td>
                            <p>Time resolution to aggregate observation counts by.</p>

                            <p>Supported values:</p>
                            <ul>
                              <li>hour</li>
                              <li>day</li>
                              <li>week</li>
                              <li>month</li>
                              <li>quarter</li>
                              <li>year</li>
                            </ul>
                          </td>
                        </tr>
                        <tr>
                          <td><strong><code>obs_date__ge</code></strong></td>
                          <td>180 days ago</td>
                          <td>Obversations greater than or equal to a given date. Dates must be formatted as <strong>YYYY-MM-DD</strong></td>
                        </tr>
                        <tr>
                          <td><strong><code>obs_date__le</code></strong></td>
                          <td>today's date</td>
                          <td>Obversations less than or equal to a given date. Dates must be formatted as <strong>YYYY-MM-DD</strong></td>
                        </tr>
                        <tr>
                          <td><strong><code>dataset_name</code></strong></td>
                          <td>none</td>
                          <td>
                            <p>Machine version of the dataset name as you get it from the <code>/v1/api/</code> endpoint. If not provided, returns all available datasets.</p>
                            <p>More than one dataset can be requested by using <code>dataset_name__in</code>  and listing multiple comma separated dataset names.</p>
                          </td>
                        </tr>
                        <tr>
                          <td><strong><code>location_geom</code></strong></td>
                          <td>none</td>
                          <td>
                            <p>A URL encoded <a href='http://geojson.org/'>GeoJSON</a> polygon representing the area of interest. Currently, the only query operator that can be applied to this is <code>within</code>.</p>

                            <p><strong>Example GeoJSON</strong> before it is <a href='http://meyerweb.com/eric/tools/dencoder/'>encoded as a URL parameter</a>:</p>
                            <pre>
{
    "type": "Feature",
    "properties": {},
    "geometry": {
        "type": "Polygon",
        "coordinates": [
            [
                [
                    -87.6933217048645,
                    41.825060359418075
                ],
                [
                    -87.6933217048645,
                    41.87671893034394
                ],
                [
                    -87.610924243927,
                    41.87671893034394
                ],
                [
                    -87.610924243927,
                    41.825060359418075
                ],
                [
                    -87.6933217048645,
                    41.825060359418075
                ]
            ]
        ]
    }
}
                            </pre>
                          </td>
                        </tr>
                        <tr>
                          <td><strong><code>data_type</code></strong></td>
                          <td>json</td>
                          <td>Response data format. Current options are <code>json</code> and <code>csv</code>. </td>
                        </tr>

                      </tbody>
                    </table>

                    <p><strong>Response</strong></p>
                    <p>The API responds with a list of datasets with a dense matrix of counts grouped by temporal aggregation.</p>
                    <table class='table table-bordered'>
                      <thead>
                        <tr>
                          <th>Parameter</th>
                          <th>Description</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td><strong><code>dataset_name</code></strong></td>
                          <td>Machine version of the dataset name</td>
                        </tr>
                        <tr>
                          <td><strong><code>items</code></strong></td>
                          <td>
                            <table class='table table-bordered'>
                              <thead>
                                <tr>
                                  <th>Parameter</th>
                                  <th>Description</th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr>
                                  <td><strong><code>count</code></strong></td>
                                  <td>Record count</td>
                                </tr>
                                <tr>
                                  <td><strong><code>datetime</code></strong></td>
                                  <td>Temporal aggregation group</td>
                                </tr>
                              </tbody>
                            </table>
                          </td>
                        </tr>
                      </tbody>
                    </table>

                    <div class='well examples'>
                      <p><strong>Examples</strong></p>
                      
                      <p><a href='/v1/api/timeseries/?agg=year&dataset_name=crimes_2001_to_present&obs_date__ge=2012-1-1'>http://plenar.io/v1/api/timeseries/?agg=year&dataset_name=crimes_2001_to_present&obs_date__ge=2012-1-1</a>
                      <br />Count of all Chicago crime reports since Jan 1st 2012, aggregated by year</p>

                      <p><a href='/v1/api/timeseries/?obs_date__ge=2007-11-12&obs_date__le=2008-11-12&dataset_name__in=crimes_2001_to_present,cdph_environmental_complaints&agg=day'>http://plenar.io/v1/api/timeseries/?obs_date__ge=2007-11-12&obs_date__le=2008-11-12&dataset_name__in=crimes_2001_to_present,cdph_environmental_complaints&agg=day</a>
                      <br />Count of crime and environmental complaints that were observed after November 12, 2007 but before November 12, 2008, aggregated by day</p>

                      <p><a href='/v1/api/timeseries/?obs_date__le=2014%2F08%2F20&obs_date__ge=2014%2F02%2F21&agg=week&data_type=csv'>http://plenar.io/v1/api/timeseries/?obs_date__le=2014%2F08%2F20&obs_date__ge=2014%2F02%2F21&agg=week&data_type=csv</a>
                      <br />
                      Count available datasets from Feb 21, 2014 to Aug 20, 2014, aggregated by week in CSV format. You could also call this a <strong>time series matrix</strong>.
                      </p>

                      <p><a href='/v1/api/timeseries/?obs_date__le=2014%2F08%2F20&obs_date__ge=2014%2F02%2F21&location_geom__within=%7B%22type%22%3A%22Feature%22%2C%22properties%22%3A%7B%7D%2C%22geometry%22%3A%7B%22type%22%3A%22Polygon%22%2C%22coordinates%22%3A%5B%5B%5B-87.65692949295044%2C41.86853817536259%5D%2C%5B-87.65692949295044%2C41.89716623689334%5D%2C%5B-87.62053728103638%2C41.89716623689334%5D%2C%5B-87.62053728103638%2C41.86853817536259%5D%2C%5B-87.65692949295044%2C41.86853817536259%5D%5D%5D%7D%7D&agg=week'>http://plenar.io/v1/api/timeseries/?obs_date__le=2014%2F08%2F20&obs_date__ge=2014%2F02%2F21&location_geom__within=%7B%22type%22%3A%22Feature%22%2C%22properties%22%3A%7B%7D%2C%22geometry%22%3A%7B%22type%22%3A%22Polygon%22%2C%22coordinates%22%3A%5B%5B%5B-87.65692949295044%2C41.86853817536259%5D%2C%5B-87.65692949295044%2C41.89716623689334%5D%2C%5B-87.62053728103638%2C41.89716623689334%5D%2C%5B-87.62053728103638%2C41.86853817536259%5D%2C%5B-87.65692949295044%2C41.86853817536259%5D%5D%5D%7D%7D&agg=week</a>
                      <br />
                      All available datasets in a bounding box (downtown Chicago) from Feb 21, 2014 to Aug 20, 2014, aggregated by week.
                      </p>
                    </div>
          </div>
        </div>
      </div>

      <div class="panel-group" id="accordion">
        <div class="panel panel-default">
          <div class="panel-heading">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapse-api-fields" id="api-fields">
              <strong><code>/v1/api/fields/&lt;dataset_name&gt;/</code></strong>
              - list available fields for a dataset
            </a>
          </div>
          <div id="collapse-api-fields" class="panel-collapse collapse">
            <div class="panel-body">
              <p>
                  Gives you a listing of all the fields and their data types for the given
                  dataset. This is useful for figuring out how to structure a query against the <code>/v1/api/detail/</code> or <code>/v1/api/detail-aggregate/</code> endpoints.
              </p>

              <p><strong>Query Parameters</strong></p>
              <p>This API endpoint doesn't take in any query parameters.</p>

              <p><strong>Response</strong></p>
              <table class='table table-bordered'>
                <thead>
                  <tr>
                    <th>Parameter</th>
                    <th>Description</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td><strong><code>field_type</code></strong></td>
                    <td><a href='http://www.postgresql.org/docs/9.3/interactive/datatype.html'>Postgres data type</a> for given field.</td>
                  </tr>
                  <tr>
                    <td><strong><code>field_name</code></strong></td>
                    <td>Name of database field. Useful for performing additional queries using the <code>/v1/api/detail-aggregate/</code> and <code>/v1/api/detail/</code> endpoints.</td>
                  </tr>
                </tbody>
              </table>

              <div class='well examples'>
                <p><strong>Example</strong></p>
                
                <p><a href='/v1/api/fields/crimes_2001_to_present'>http://plenar.io/v1/api/fields/crimes_2001_to_present</a><br />
                Field definitions for Chicago crime report dataset</p>
              </div>
          </div>
        </div>
      </div>

      <div class="panel-group" id="accordion">
        <div class="panel panel-default">
          <div class="panel-heading">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapse-api-detail-aggregate" id="api-detail-aggregate">
              <strong><code>/v1/api/detail-aggregate/</code></strong>
              - query a single dataset and return an aggregate count
            </a>
          </div>
          <div id="collapse-api-detail-aggregate" class="panel-collapse collapse">
            <div class="panel-body">
              <p>
                  Very similar to the /v1/api/timeseries/ API endpoint, but for one dataset. Additional dataset-specific query parameters can be used to filter the results.
              </p>

              <p><strong>Query parameters</strong></p>
              <p>All query parameters are optional except for <code>dataset_name</code>.</p>
              <table class='table table-bordered'>
                <thead>
                  <tr>
                    <th>Parameter</th>
                    <th>Default value</th>
                    <th>Description</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td><strong><code>dataset_name</code></strong></td>
                    <td>none</td>
                    <td><strong>Required.</strong> Machine version of the dataset name as you get it from the <code>/v1/api/</code> endpoint.</td>
                  </tr>
                  <tr>
                    <td><strong><code>[dataset_field]*</code></strong></td>
                    <td>none</td>
                    <td>
                      <p>Any available dataset field. Discoverable via the <code>/v1/api/fields/&lt;dataset_name&gt;/</code> endpoint. Any number of these query parameters can be chained together and are linked together with a SQL <code>AND</code> under the hood.</p>

                      <p><strong>Query operators</strong><br/> For any given <code>dataset_field</code>, the query can be modified with any of the following operators:</p>

                      <table class='table table-bordered'>
                        <thead>
                          <tr>
                            <th>Operator</th>
                            <th>Description</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr>
                            <td><strong><code>__gt</code></strong> </td>
                            <td>greater than (<code>&gt;</code>)</td>
                          </tr>
                          <tr>
                            <td><strong><code>__ge</code></strong></td>
                            <td>greater than or equal to (<code>&gt;=</code>)</td>
                          </tr>
                          <tr>
                            <td><strong><code>__lt</code></strong> </td>
                            <td>less than (<code>&lt;</code>)</td>
                          </tr>
                          <tr>
                            <td><strong><code>__le</code></strong></td>
                            <td>less than or equal to (<code>&lt;=</code>)</td>
                          </tr>
                          <tr>
                            <td><strong><code>__ne</code></strong> </td>
                            <td>not equal (<code>!=</code>)</td>
                          </tr>
                          <tr>
                            <td><strong><code>__like</code></strong> </td>
                            <td>like value with % wildcards, case sensitive (<code>LIKE 'State%'</code>)</td>
                          </tr>
                          <tr>
                            <td><strong><code>__ilike</code></strong> </td>
                            <td>like value with % wildcards, case insensitive (<code>ILIKE 'state%'</code>)</td>
                          </tr>
                          <tr>
                            <td><strong><code>__in</code></strong> </td>
                            <td>within a list of provided values (<code>IN ('list', 'of', 'values')</code>)</td>
                          </tr>
                        </tbody>
                      </table>

                      <p><strong>Example:</strong> <code>ward__ge=48</code> translates to "ward >= 48" in SQL</p>
                    </td>
                  </tr>
                  <tr>
                    <td><strong><code>agg</code></strong></td>
                    <td>day</td>
                    <td>
                      <p>Time resolution to aggregate observation counts by.</p>

                      <p>Supported values:</p>
                      <ul>
                        <li>hour</li>
                        <li>day</li>
                        <li>week</li>
                        <li>month</li>
                        <li>quarter</li>
                        <li>year</li>
                      </ul>
                    </td>
                  </tr>
                  <tr>
                    <td><strong><code>obs_date__ge</code></strong></td>
                    <td>180 days ago</td>
                    <td>Obversations greater than or equal to a given date. Dates must be formatted as <strong>YYYY-MM-DD</strong></td>
                  </tr>
                  <tr>
                    <td><strong><code>obs_date__le</code></strong></td>
                    <td>today's date</td>
                    <td>Obversations less than or equal to a given date. Dates must be formatted as <strong>YYYY-MM-DD</strong></td>
                  </tr>
                  <tr>
                    <td><strong><code>location_geom</code></strong></td>
                    <td>none</td>
                    <td>A <a href='https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify'>stringified</a> <a href='http://geojson.org/'>GeoJSON</a> polygon representing the area of interest. Currently, the only query operator that can be applied to this is <code>within</code>.</td>
                  </tr>
                  <tr>
                    <td><strong><code>data_type</code></strong></td>
                    <td>json</td>
                    <td>Response data format. Current options are <code>json</code> and <code>csv</code>. </td>
                  </tr>

                </tbody>
              </table>

              <p><strong>Response</strong></p>
              <p>The API responds with a list of counts grouped by temporal aggregation and dataset name.</p>
              <table class='table table-bordered'>
                <thead>
                  <tr>
                    <th>Parameter</th>
                    <th>Description</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td><strong><code>count</code></strong></td>
                    <td>Record count</td>
                  </tr>
                  <tr>
                    <td><strong><code>datetime</code></strong></td>
                    <td>Temporal aggregation group</td>
                  </tr>
                </tbody>
              </table>

              <div class='well examples'>
                <p><strong>Example</strong></p>
                
                <p><a href='/v1/api/detail-aggregate/?agg=year&dataset_name=crimes_2001_to_present&obs_date__ge=2012-1-1&iucr=0110'>http://plenar.io/v1/api/detail-aggregate/?agg=year&dataset_name=crimes_2001_to_present&obs_date__ge=2012-1-1&iucr=0110</a><br />
                Chicago crime reports since Jan 1st 2012, aggregated by year with <a href='http://gis.chicagopolice.org/clearmap_crime_sums/crime_types.html'>IUCR code</a> of '0110' (homicide)</p>
              </div>
          </div>
        </div>
      </div>

      <div class="panel-group" id="accordion">
        <div class="panel panel-default">
          <div class="panel-heading">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapse-api-detail" id="api-detail">
              <strong><code>/v1/api/detail/</code></strong>
              - query a single dataset and return all raw data
            </a>
          </div>
          <div id="collapse-api-detail" class="panel-collapse collapse">
            <div class="panel-body">
              <p>
                  Query a particular dataset and get back the raw individual records.
              </p>

              <p><strong>Query parameters</strong></p>
              <p>All query parameters are optional except for <code>dataset_name</code>.</p>
              <table class='table table-bordered'>
                <thead>
                  <tr>
                    <th>Parameter</th>
                    <th>Default value</th>
                    <th>Description</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td><strong><code>dataset_name</code></strong></td>
                    <td>none</td>
                    <td><strong>Required.</strong> Machine version of the dataset name as you get it from the <code>/v1/api/</code> endpoint.</td>
                  </tr>
                  <tr>
                    <td><strong><code>[dataset_field]*</code></strong></td>
                    <td>none</td>
                    <td>
                      <p>Any available dataset field. Discoverable via the <code>/v1/api/fields/&lt;dataset_name&gt;/</code> endpoint. Any number of these query parameters can be chained together and are linked together with a SQL <code>AND</code> under the hood.</p>

                      <p><strong>Query operators</strong><br/> For any given <code>dataset_field</code>, the query can be modified with any of the following operators:</p>

                      <table class='table table-bordered'>
                        <thead>
                          <tr>
                            <th>Operator</th>
                            <th>Description</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr>
                            <td><strong><code>__gt</code></strong> </td>
                            <td>greater than (<code>&gt;</code>)</td>
                          </tr>
                          <tr>
                            <td><strong><code>__ge</code></strong></td>
                            <td> greater than or equal to (<code>&gt;=</code>)</td>
                          </tr>
                          <tr>
                            <td><strong><code>__lt</code></strong> </td>
                            <td>less than (<code>&lt;</code>)</td>
                          </tr>
                          <tr>
                            <td><strong><code>__le</code></strong></td>
                            <td> less than or equal to (<code>&lt;=</code>)</td>
                          </tr>
                          <tr>
                            <td><strong><code>__ne</code></strong> </td>
                            <td>not equal (<code>!=</code>)</td>
                          </tr>
                          <tr>
                            <td><strong><code>__like</code></strong> </td>
                            <td>like value with % wildcards, case sensitive (<code>LIKE 'State%'</code>)</td>
                          </tr>
                          <tr>
                            <td><strong><code>__ilike</code></strong> </td>
                            <td>like value with % wildcards, case insensitive (<code>ILIKE 'state%'</code>)</td>
                          </tr>
                          <tr>
                            <td><strong><code>__in</code></strong> </td>
                            <td>within a list of provided values (<code>IN ('list', 'of', 'values')</code>)</td>
                          </tr>
                        </tbody>
                      </table>

                      <p><strong>Example:</strong> <code>ward__ge=48</code> translates to "ward >= 48" in SQL</p>
                    </td>
                  </tr>
                  <tr>
                    <td><strong><code>obs_date</code></strong></td>
                    <td>greater than or equal to 30 days ago</td>
                    <td>Date of obversations. This can
                  have filters applied such as <code>__gt</code> (greater than) and <code>__lt</code> (less than).</td>
                  </tr>
                  <tr>
                    <td><strong><code>location_geom</code></strong></td>
                    <td>none</td>
                    <td>A <a href='https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify'>stringified</a> <a href='http://geojson.org/'>GeoJSON</a> polygon representing the area of interest. Currently, the only query operator that can be applied to this is <code>within</code>.</td>
                  </tr>
                  <tr>
                    <td><strong><code>data_type</code></strong></td>
                    <td>json</td>
                    <td>Response data format. Current options are <code>json</code> and <code>csv</code>. </td>
                  </tr>

                </tbody>
              </table>

              <p><strong>Response</strong></p>
              <p>The API responds with a list of raw records for the particular dataset. The fields returned will vary per dataset.</p>

              <div class='well examples'>
                <p><strong>Example</strong></p>
                
                <p><a href='/v1/api/detail/?dataset_name=crimes_2001_to_present&obs_date__ge=2014-1-1&iucr=0110'>http://plenar.io/v1/api/detail/?dataset_name=crimes_2001_to_present&obs_date__ge=2014-1-1&iucr=0110</a><br />
                Chicago crime reports since Jan 1st 2014 with <a href='http://gis.chicagopolice.org/clearmap_crime_sums/crime_types.html'>IUCR code</a> of '0110' (homicide)</p>
              </div>
          </div>
        </div>
      </div>

      <div class="panel-group" id="accordion">
        <div class="panel panel-default">
          <div class="panel-heading">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapse-api-grid" id="api-grid">
              <strong><code>/v1/api/grid/</code></strong>
              - query a single dataset and return a GeoJSON grid heatmap
            </a>
          </div>
          <div id="collapse-api-grid" class="panel-collapse collapse">
            <div class="panel-body">
                    <p>
                        Query a single dataset and return a GeoJSON grid heatmap.
                    </p>

                    <p><strong>Query parameters</strong></p>
                    <p>All query parameters are optional except for <code>dataset_name</code>.</p>
                    <table class='table table-bordered'>
                      <thead>
                        <tr>
                          <th>Parameter</th>
                          <th>Default value</th>
                          <th>Description</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td><strong><code>dataset_name</code></strong></td>
                          <td>none</td>
                          <td><strong>Required.</strong> Machine version of the dataset name as you get it from the <code>/v1/api/</code> endpoint.</td>
                        </tr>
                        <tr>
                          <td><strong><code>[dataset_field]*</code></strong></td>
                          <td>none</td>
                          <td>
                            <p>Any available dataset field. Discoverable via the <code>/v1/api/fields/&lt;dataset_name&gt;/</code> endpoint. Any number of these query parameters can be chained together and are linked together with a SQL <code>AND</code> under the hood.</p>

                            <p><strong>Query operators</strong><br/> For any given <code>dataset_field</code>, the query can be modified with any of the following operators:</p>

                            <table class='table table-bordered'>
                              <thead>
                                <tr>
                                  <th>Operator</th>
                                  <th>Description</th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr>
                                  <td><strong><code>__gt</code></strong> </td>
                                  <td>greater than (<code>&gt;</code>)</td>
                                </tr>
                                <tr>
                                  <td><strong><code>__ge</code></strong></td>
                                  <td> greater than or equal to (<code>&gt;=</code>)</td>
                                </tr>
                                <tr>
                                  <td><strong><code>__lt</code></strong> </td>
                                  <td>less than (<code>&lt;</code>)</td>
                                </tr>
                                <tr>
                                  <td><strong><code>__le</code></strong></td>
                                  <td> less than or equal to (<code>&lt;=</code>)</td>
                                </tr>
                                <tr>
                                  <td><strong><code>__ne</code></strong> </td>
                                  <td>not equal (<code>!=</code>)</td>
                                </tr>
                                <tr>
                                  <td><strong><code>__in</code></strong> </td>
                                  <td>within a list of provided values (<code>IN ('list', 'of', 'values')</code>)</td>
                                </tr>
                              </tbody>
                            </table>

                            <p><strong>Example:</strong> <code>ward__ge=48</code> translates to "ward >= 48" in SQL</p>
                          </td>
                        </tr>
                        <tr>
                          <td><strong><code>obs_date__ge</code></strong></td>
                          <td>180 days ago</td>
                          <td>Obversations greater than or equal to a given date. Dates must be formatted as <strong>YYYY-MM-DD</strong></td>
                        </tr>
                        <tr>
                          <td><strong><code>obs_date__le</code></strong></td>
                          <td>today's date</td>
                          <td>Obversations less than or equal to a given date. Dates must be formatted as <strong>YYYY-MM-DD</strong></td>
                        </tr>
                        <tr>
                          <td><strong><code>center[]</code></strong></td>
                          <td>[41.880517,-87.644061]</td>
                          <td>Latitude and longitude of map center. Used for proper geospatial projection. If you are querying data outside of Chicago, you should provide a new center.</td>
                        </tr>
                        <tr>
                          <td><strong><code>resolution</code></strong></td>
                          <td>500</td>
                          <td>Square grid size (in meters).</td>
                        </tr>
                        <tr>
                          <td><strong><code>location_geom</code></strong></td>
                          <td>none</td>
                          <td>A <a href='https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify'>stringified</a> <a href='http://geojson.org/'>GeoJSON</a> polygon representing the area of interest. Currently, the only query operator that can be applied to this is <code>within</code>.</td>
                        </tr>
                        <tr>
                          <td><strong><code>buffer</code></strong></td>
                          <td>100</td>
                          <td>If <code>location_geom</code> is a <a href='http://geojson.org/geojson-spec.html#linestring'>GeoJSON LineString</a>, the size of the buffer around that line to query (in meters).</td>
                        </tr>
                      </tbody>
                    </table>

                    <p><strong>Response</strong></p>
                    <p>GeoJSON with a feature for each grid square containing a <code>count</code> property of observations within that square.</p>
                    <pre>
{
   "type":"FeatureCollection",
   "features":[
      {
         "geometry":{
            "type":"Polygon",
            "coordinates":[
               [
                  [
                     -87.69635961403962,
                     41.876826253090584
                  ],
                  [
                     -87.69635961403962,
                     41.88132164531356
                  ],
                  [
                     -87.70239743700178,
                     41.88132164531356
                  ],
                  [
                     -87.70239743700178,
                     41.876826253090584
                  ],
                  [
                     -87.69635961403962,
                     41.876826253090584
                  ]
               ]
            ]
         },
         "type":"Feature",
         "properties":{
            "count":7
         }
      }

      ...

   ]
}
                    </pre>

                    <div class='well examples'>
                      <p><strong>Example</strong></p>
                      <p><a href='/v1/api/grid/?obs_date__le=2014%2F09%2F05&obs_date__ge=2014%2F03%2F09&dataset_name=311_service_requests_tree_trims&ward__in=2%2C42%2C32'>http://plenar.io/v1/api/grid/?obs_date__le=2014%2F09%2F05&obs_date__ge=2014%2F03%2F09&dataset_name=311_service_requests_tree_trims&ward__in=2%2C42%2C32</a><br />
                      311 tree trim requests between March 9, 2014 and September 5th, 2014 for Wards 2, 42 and 32</p>
                    </div>
                </div>
          </div>
        </div>
      </div>

      <h3 id='responses'>API responses</h3>
      <p>All JSON API calls return their data in the <code>objects</code> block. Additional information is returned in the <code>meta</code> block:</p>

      <table class='table table-bordered'>
        <thead>
          <tr>
            <th>Parameter</th>
            <th>Description</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong><code>status</code></strong></td>
            <td><strong>ok</strong> if query was sucessful, <strong>error</strong> if not.</td>
          </tr>
          <tr>
            <td><strong><code>query</code></strong></td>
            <td>Original query parameters passed in.</td>
          </tr>
          <tr>
            <td><strong><code>message</code></strong></td>
            <td>If <code>status</code> is <strong>error</strong>, a detailed message as to what went wrong.</td>
          </tr>
        </tbody>
      </table>

      Here's an example response from the /v1/api/timeseries/ endpoint:

      <pre>
{
   "meta":{
      "status":"ok",
      "query":{
         "agg":"week",
         "dataset_name__in":"cdph_environmental_complaints",
         "obs_date__ge":"2007-12-12",
         "obs_date__le":"2008-01-12"
      },
      "message":""
   },
   "objects":[
      {
         "items":[
            {
               "count":8,
               "datetime":"2007-12-10T00:00:00"
            },
            {
               "count":8,
               "datetime":"2007-12-17T00:00:00"
            },
            {
               "count":5,
               "datetime":"2007-12-24T00:00:00"
            },
            {
               "count":7,
               "datetime":"2007-12-31T00:00:00"
            },
            {
               "count":22,
               "datetime":"2008-01-07T00:00:00"
            }
         ],
         "dataset_name":"cdph_environmental_complaints"
      }
   ]
}
      </pre>

      <!-- <div class="panel-group" id="accordion">
        <div class="panel panel-default">
          <div class="panel-heading">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapse-api" id="api">
              <strong><code>/v1/api/grid/</code></strong>
              - query a single dataset and return a GeoJSON grid heatmap
            </a>
          </div>
          <div id="collapse-api" class="panel-collapse collapse">
            <div class="panel-body">
              
          </div>
        </div>
      </div> -->
      
{% endblock content %}